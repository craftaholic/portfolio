---
title: Terraform workflow implementation
date: 2024-09-10
overview: Built the Terraform plan/apply workflow with state management.
---

## Terraform Integration

Today I implemented the core Terraform workflow: plan, approve, apply.

## Workflow Design

```
Request → Validate → Plan → Review → Approve → Apply → Notify
                       ↓
                   Store Plan
```

The key insight: never auto-apply. Always require human approval for infrastructure changes, but make the approval process as smooth as possible.

## Implementation Details

**Plan Generation**
- Terraform runs in isolated containers
- Each plan gets a unique ID
- Plan output stored in PostgreSQL for review

**State Management**
- Using Terraform Cloud backend initially
- Plan to support S3/GCS backends later
- State locking via PostgreSQL advisory locks

**Execution**
- Jobs run in Kubernetes pods
- Resource limits to prevent runaway processes
- Logs streamed to NATS for real-time updates

## Security Considerations

- Provider credentials injected at runtime via Vault
- No credentials stored in Git
- Audit log of all operations
- RBAC for who can approve what

## What's Working

- Single-resource Terraform plans
- GitHub PR creation with plan output
- Manual approval via API
- Apply with status notifications
