---
import { NAV_LINKS } from '../../config';

/** Test if a link is pointing to the current page. */
const isCurrentPage = (href: string) => {
	let pathname = Astro.url.pathname.replace(import.meta.env.BASE_URL, '');
	if (pathname.at(0) !== '/') pathname = '/' + pathname;
	if (pathname.at(-1) !== '/') pathname += '/';
	return pathname === href || (href !== '/' && pathname.startsWith(href));
};
---

<nav class="bottom-tab-bar" aria-label="Mobile navigation">
	<ul class="tab-list">
		{
			NAV_LINKS.map(({ label, href }) => (
				<li>
					<a
						href={href}
						class:list={['tab-item', { active: isCurrentPage(href) }]}
						aria-current={isCurrentPage(href) ? 'page' : undefined}
					>
						{label}
					</a>
				</li>
			))
		}
	</ul>
</nav>

<style>
	.bottom-tab-bar {
		display: flex;
		justify-content: center;
		position: fixed;
		bottom: 1rem;
		bottom: calc(1rem + env(safe-area-inset-bottom, 0px));
		left: 50%;
		transform: translateX(-50%);
		z-index: 9999;
	}

	.tab-list {
		position: relative;
		display: flex;
		align-items: center;
		list-style: none;
		margin: 0;
		padding: 0.5rem 0.5625rem;
		gap: 0.25rem;
		background: radial-gradient(var(--gray-900), var(--gray-800) 150%);
		border-radius: 999rem;
		box-shadow: var(--shadow-md);
	}

	/* Gradient border like desktop nav */
	.tab-list::before {
		position: absolute;
		inset: -1px;
		content: '';
		background: var(--gradient-stroke);
		border-radius: 999rem;
		z-index: -1;
	}

	.tab-item {
		display: flex;
		align-items: center;
		justify-content: center;
		padding: 0.5rem 0.75rem;
		font-size: var(--text-sm);
		font-weight: 500;
		color: var(--gray-300);
		text-decoration: none;
		border-radius: 999rem;
		transition:
			color var(--theme-transition),
			background-color var(--theme-transition);
		white-space: nowrap;
	}

	.tab-item:hover,
	.tab-item:focus {
		color: var(--gray-100);
		background-color: var(--accent-subtle-overlay);
	}

	.tab-item.active {
		color: var(--accent-text-over);
		background-color: var(--accent-regular);
	}

	/* Hide on desktop */
	@media (min-width: 50em) {
		.bottom-tab-bar {
			display: none;
		}
	}
</style>
