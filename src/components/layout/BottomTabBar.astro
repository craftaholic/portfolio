---
import { NAV_LINKS } from '../../config';
import { isCurrentPage } from '../../utils/navigation';

const pathname = Astro.url.pathname.replace(import.meta.env.BASE_URL, '');
---

<nav class="bottom-tab-bar" aria-label="Mobile navigation">
	<ul class="tab-list">
		<li class="tab-indicator" aria-hidden="true"></li>
		{
			NAV_LINKS.map(({ label, href }) => (
				<li>
					<a
						href={href}
						class:list={['tab-item', { active: isCurrentPage(pathname, href) }]}
						aria-current={isCurrentPage(pathname, href) ? 'page' : undefined}
					>
						{label}
					</a>
				</li>
			))
		}
	</ul>
</nav>

<script>
	import { setupSlidingIndicator } from '../../utils/slidingIndicator';

	setupSlidingIndicator({
		containerSelector: '.bottom-tab-bar .tab-list',
		indicatorSelector: '.bottom-tab-bar .tab-indicator',
		linkSelector: '.bottom-tab-bar .tab-item',
		activeClass: 'active',
	});
</script>

<style>
	.bottom-tab-bar {
		display: flex;
		justify-content: center;
		position: fixed;
		bottom: 1rem;
		bottom: calc(1rem + env(safe-area-inset-bottom, 0px));
		left: 50%;
		transform: translateX(-50%);
		z-index: 9999;
		/* Prevent disappearing during view transitions */
		view-transition-name: bottom-tab-bar;
	}

	/* Disable animation for this element during transitions */
	::view-transition-old(bottom-tab-bar),
	::view-transition-new(bottom-tab-bar) {
		animation: none;
		mix-blend-mode: normal;
	}

	.tab-list {
		position: relative;
		display: flex;
		align-items: center;
		list-style: none;
		margin: 0;
		padding: 0.5rem 0.5625rem;
		gap: 0.25rem;
		background: radial-gradient(var(--gray-900), var(--gray-800) 150%);
		border-radius: 999rem;
		box-shadow: var(--shadow-md);
	}

	/* Gradient border like desktop nav */
	.tab-list::before {
		position: absolute;
		inset: -1px;
		content: '';
		background: var(--gradient-stroke);
		border-radius: 999rem;
		z-index: -1;
	}

	.tab-indicator {
		position: absolute;
		top: 0;
		left: 0;
		background-color: var(--accent-regular);
		border-radius: 999rem;
		opacity: 0;
		z-index: 0;
		pointer-events: none;
		will-change: transform, width, height;
	}

	.tab-item {
		position: relative;
		z-index: 1;
		display: flex;
		align-items: center;
		justify-content: center;
		padding: 0.5rem 0.75rem;
		font-size: var(--text-sm);
		font-weight: 500;
		color: var(--gray-300);
		text-decoration: none;
		border-radius: 999rem;
		transition: color var(--theme-transition);
		white-space: nowrap;
	}

	.tab-item:hover,
	.tab-item:focus {
		color: var(--gray-100);
	}

	.tab-item.active {
		color: var(--accent-text-over);
	}

	/* Hide on desktop */
	@media (min-width: 50em) {
		.bottom-tab-bar {
			display: none;
		}
	}
</style>
