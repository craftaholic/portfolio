---
import { NAV_LINKS } from '../../config';
import { isCurrentPage } from '../../utils/navigation';

const pathname = Astro.url.pathname.replace(import.meta.env.BASE_URL, '');
---

<nav class="bottom-tab-bar" aria-label="Navigation">
	<ul class="tab-list">
		{
			NAV_LINKS.map(({ label, href }) => (
				<li>
					<a
						href={href}
						class:list={['tab-item', { active: isCurrentPage(pathname, href) }]}
						aria-current={isCurrentPage(pathname, href) ? 'page' : undefined}
					>
						{label}
					</a>
				</li>
			))
		}
	</ul>
</nav>

<script>
	// Immediate visual feedback on click
	document.addEventListener('click', (e) => {
		const link = (e.target as HTMLElement).closest('.tab-item');
		if (link) {
			document.querySelectorAll('.tab-item').forEach(item => item.classList.remove('active'));
			link.classList.add('active');
		}
	});
</script>

<style>
	.bottom-tab-bar {
		display: flex;
		justify-content: center;
		position: fixed;
		bottom: 1rem;
		bottom: calc(1rem + env(safe-area-inset-bottom, 0px));
		left: 50%;
		transform: translateX(-50%);
		z-index: 9999;
		/* Prevent disappearing during view transitions */
		view-transition-name: bottom-tab-bar;
	}

	/* Disable animation for this element during transitions */
	::view-transition-old(bottom-tab-bar),
	::view-transition-new(bottom-tab-bar) {
		animation: none;
		mix-blend-mode: normal;
	}

	.tab-list {
		position: relative;
		display: flex;
		align-items: center;
		list-style: none;
		margin: 0;
		padding: 0.5rem 0.5625rem;
		gap: 0.25rem;
		background: linear-gradient(
			135deg,
			hsla(var(--gray-999-basis), 0.6) 0%,
			hsla(var(--gray-999-basis), 0.5) 100%
		);
		backdrop-filter: blur(20px) saturate(180%);
		-webkit-backdrop-filter: blur(20px) saturate(180%);
		border: 1px solid hsla(var(--gray-999-basis), 0.4);
		border-top-color: hsla(var(--gray-999-basis), 0.6);
		border-left-color: hsla(var(--gray-999-basis), 0.5);
		border-radius: 999rem;
		box-shadow:
			var(--shadow-md),
			inset 0 1px 1px hsla(var(--gray-999-basis), 0.4),
			inset 0 -1px 1px hsla(0, 0%, 0%, 0.05);
	}

	.tab-item {
		display: flex;
		align-items: center;
		justify-content: center;
		padding: 0.5rem 0.75rem;
		font-size: var(--text-sm);
		font-weight: 600;
		color: var(--gray-100);
		text-decoration: none;
		border-radius: 999rem;
		transition: color 0.15s ease, background-color 0.15s ease;
		white-space: nowrap;
	}

	.tab-item:hover,
	.tab-item:focus {
		color: var(--gray-0);
	}

	.tab-item.active {
		color: var(--accent-text-over);
		background-color: var(--accent-regular);
	}

	/* Scale down for very small screens */
	@media (max-width: 400px) {
		.tab-list {
			padding: 0.4rem 0.45rem;
			gap: 0.15rem;
		}

		.tab-item {
			padding: 0.4rem 0.5rem;
			font-size: var(--text-xs, 0.75rem);
		}
	}

	@media (max-width: 340px) {
		.tab-list {
			padding: 0.35rem 0.4rem;
			gap: 0.1rem;
		}

		.tab-item {
			padding: 0.35rem 0.4rem;
			font-size: 0.65rem;
		}
	}

</style>
